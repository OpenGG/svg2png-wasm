<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>svg2png test</title>
    <style>
      @font-face {
        font-family: 'Roboto Black';
        src: url(/test/browser/Roboto-BlackItalic.ttf);
        font-style: italic;
      }
    </style>
  </head>
  <body>
    <svg
      id="svg"
      viewBox="0 0 100 100"
      width="200px"
      height="200px"
      xmlns="http://www.w3.org/2000/svg"
    >
      <defs>
        <pattern id="star" viewBox="0,0,10,10" width="10%" height="10%">
          <polygon points="0,0 2,5 0,10 5,8 10,10 8,5 10,0 5,2" />
        </pattern>
      </defs>
      <circle cx="50" cy="50" r="30" fill="url(#star)" />
      <mask id="myMask">
        <!-- Everything under a white pixel will be visible -->
        <rect x="0" y="0" width="100" height="100" fill="white" />
        <!-- Everything under a black pixel will be invisible -->
        <path
          d="M10,35 A20,20,0,0,1,50,35 A20,20,0,0,1,90,35 Q90,65,50,95 Q10,65,10,35 Z"
          fill="black"
        />
      </mask>
      <defs>
        <linearGradient id="myGradient" gradientTransform="rotate(90)">
          <stop offset="5%" stop-color="gold" />
          <stop offset="95%" stop-color="red" />
        </linearGradient>
      </defs>
      <circle
        cx="50"
        cy="50"
        r="60"
        fill="url('#myGradient')"
        mask="url(#myMask)"
      />
      <text font-size="20" y="80" font-family="sans-serif">svg2png-wasm</text>
      <text font-size="20" y="60" font-family="Roboto Black">svg2png-wasm</text>
    </svg>
    <img id="img" alt="result" />
    <script src="/umd/index.js"></script>
    <script>
      document.addEventListener('DOMContentLoaded', async () => {
        try {
          const svg2png = SVG2PNG_CORE.createSvg2png('/svg2png_wasm_bg.wasm');
          const roboto = await fetch(
            '/test/browser/Roboto-BlackItalic.ttf',
          ).then((res) => res.arrayBuffer());
          const svgData = document.getElementById('svg').outerHTML;
          const png = await svg2png(svgData, {
            fonts: [new Uint8Array(roboto)],
            defaultFontFamily: {
              sansSerifFamily: 'Roboto Black',
            },
          });
          document.getElementById('img').src = URL.createObjectURL(
            new Blob([png.buffer], { type: 'image/png' }),
          );
        } catch (e) {
          console.error(e);
        } finally {
          window.processComplete = true;
        }
      });
    </script>
  </body>
</html>
