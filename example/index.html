<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Demo</title>
    <style>
      @font-face {
        font-family: 'Roboto Thin';
        src: url('/Roboto-Thin.ttf');
      }
      section {
        display: flex;
      }
      td {
        border: 1px solid #999;
        text-align: center;
      }
    </style>
  </head>
  <body>
    <table>
      <tr>
        <th></th>
        <th>SVG</th>
        <th>img(data-url)</th>
        <th>img(canvg)</th>
        <th>img(svg2png-wasm)</th>
      </tr>
      <tr>
        <th>‚óè</th>
        <td>
          <svg
            id="source1"
            width="100px"
            height="100px"
            viewBox="0 0 200 200"
            xmlns="http://www.w3.org/2000/svg"
          >
            <circle cx="100" cy="100" r="100" />
          </svg>
        </td>
        <td>
          <img id="durl1" />
        </td>
        <td>
          <img id="cvg1" />
        </td>
        <td>
          <img id="dist1" />
        </td>
      </tr>
      <tr>
        <th>A!</th>
        <td>
          <svg
            id="source2"
            width="100px"
            height="100px"
            viewBox="0 0 200 200"
            xmlns="http://www.w3.org/2000/svg"
          >
            <text x="0" y="180" font-size="180" font-family="Roboto Thin">
              A!
            </text>
          </svg>
        </td>
        <td>
          <img id="durl2" />
        </td>
        <td>
          <img id="cvg2" />
        </td>
        <td>
          <img id="dist2" />
        </td>
      </tr>
      <tr>
        <th>
          <a
            href="https://developer.mozilla.org/en-US/docs/Web/SVG/Tutorial/Paths#:~:text=%3Csvg%20width%3D%22325%22%20height%3D%22325%22%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%3E"
            target="_blank"
          >
            complex
          </a>
        </th>
        <td>
          <svg
            id="source3"
            width="325"
            height="325"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M 80 80 A 45 45, 0, 0, 0, 125 125 L 125 80 Z"
              fill="green"
            />
            <path
              d="M 230 80 A 45 45, 0, 1, 0, 275 125 L 275 80 Z"
              fill="red"
            />
            <path
              d="M 80 230 A 45 45, 0, 0, 1, 125 275 L 125 230 Z"
              fill="purple"
            />
            <path
              d="M 230 230 A 45 45, 0, 1, 1, 275 275 L 275 230 Z"
              fill="blue"
            />
          </svg>
        </td>
        <td>
          <img id="durl3" />
        </td>
        <td>
          <img id="cvg3" />
        </td>
        <td>
          <img id="dist3" />
        </td>
      </tr>
      <tr>
        <th>
          <a
            href="https://developer.mozilla.org/en-US/docs/Web/SVG/Tutorial/Gradients#basic_example_2"
            target="_blank"
          >
            gradient
          </a>
        </th>
        <td>
          <svg
            id="source4"
            width="120"
            height="240"
            version="1.1"
            xmlns="http://www.w3.org/2000/svg"
          >
            <defs>
              <radialGradient id="RadialGradient1">
                <stop offset="0%" stop-color="red" />
                <stop offset="100%" stop-color="blue" />
              </radialGradient>
              <radialGradient id="RadialGradient2" cx="0.25" cy="0.25" r="0.25">
                <stop offset="0%" stop-color="red" />
                <stop offset="100%" stop-color="blue" />
              </radialGradient>
            </defs>

            <rect
              x="10"
              y="10"
              rx="15"
              ry="15"
              width="100"
              height="100"
              fill="url(#RadialGradient1)"
            />
            <rect
              x="10"
              y="120"
              rx="15"
              ry="15"
              width="100"
              height="100"
              fill="url(#RadialGradient2)"
            />
          </svg>
        </td>
        <td>
          <img id="durl4" />
        </td>
        <td>
          <img id="cvg4" />
        </td>
        <td>
          <img id="dist4" />
        </td>
      </tr>
      <tr>
        <th>
          <a
            href="https://developer.mozilla.org/en-US/docs/Web/SVG/Tutorial/Texts#textpath"
            target="_blank"
          >
            text
          </a>
        </th>
        <td>
          <svg
            id="source5"
            width="150"
            height="100"
            version="1.1"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              id="my_path"
              d="M 20,20 C 80,60 100,40 120,20"
              fill="transparent"
            />
            <text>
              <textPath
                xmlns:xlink="http://www.w3.org/1999/xlink"
                xlink:href="#my_path"
              >
                A curve.
              </textPath>
            </text>
          </svg>
        </td>
        <td>
          <img id="durl5" />
        </td>
        <td>
          <img id="cvg5" />
        </td>
        <td>
          <img id="dist5" />
        </td>
      </tr>
    </table>
    <script src="https://unpkg.com/svg2png-wasm"></script>
    <script src="https://unpkg.com/canvg/lib/umd.js"></script>
    <script>
      const setDataURL = (id, svg) => {
        document.getElementById(
          id,
        ).src = `data:image/svg+xml;charset=utf-8;base64,${btoa(
          unescape(encodeURIComponent(svg)),
        )}`;
      };
      const setSvg2Png = async (id, svg, fonts = []) => {
        const res = await SVG2PNG.svg2png(svg, { fonts });
        document.getElementById(id).src = URL.createObjectURL(
          new Blob([res.buffer], { type: 'image/png' }),
        );
      };
      const setCanvg = async (id, svg) => {
        const canvas = document.createElement('canvas');
        const ctx = canvas.getContext('2d');
        const renderer = canvg.Canvg.fromString(ctx, svg);
        await renderer.render();
        document.getElementById(id).src = canvas.toDataURL();
      };

      const main = async () => {
        const roboto = new Uint8Array(
          await fetch('/Roboto-Thin.ttf').then((res) => res.arrayBuffer()),
        );

        const source1 = document.getElementById('source1').outerHTML;
        setDataURL('durl1', source1);
        setCanvg('cvg1', source1);
        setSvg2Png('dist1', source1);

        const source2 = document.getElementById('source2').outerHTML;
        setDataURL('durl2', source2);
        setCanvg('cvg2', source2);
        setSvg2Png('dist2', source2, [roboto]);

        const source3 = document.getElementById('source3').outerHTML;
        setDataURL('durl3', source3);
        setCanvg('cvg3', source3);
        setSvg2Png('dist3', source3);

        const source4 = document.getElementById('source4').outerHTML;
        setDataURL('durl4', source4);
        setCanvg('cvg4', source4);
        setSvg2Png('dist4', source4);

        const source5 = document.getElementById('source5').outerHTML;
        setDataURL('durl5', source5);
        setCanvg('cvg5', source5);
        setSvg2Png('dist5', source5);
      };
      document.addEventListener('DOMContentLoaded', main);
    </script>
  </body>
</html>
